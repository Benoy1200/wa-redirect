<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting to WhatsApp</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            display: grid; 
            place-items: center; 
            min-height: 90vh; 
            text-align: center; 
            background-color: #f4f4f5;
            color: #333;
            margin: 0;
        }
        .container { 
            padding: 30px; 
            background-color: #ffffff;
            border: 1px solid #ddd; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            max-width: 360px;
        }
        .title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 16px auto 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tip-text {
            font-size: 0.95em;
            color: #555;
            line-height: 1.5;
            margin-bottom: 18px;
        }
        .wa-button {
            display: inline-block;
            width: 100%;
            padding: 12px 16px;
            border-radius: 999px;
            border: none;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            background-color: #25D366; /* WhatsApp green */
            color: #ffffff;
            box-shadow: 0 3px 8px rgba(37, 211, 102, 0.3);
            transition: transform 0.08s ease-out, box-shadow 0.08s ease-out, background-color 0.1s ease-out;
        }
        .wa-button:active {
            transform: translateY(1px);
            box-shadow: 0 1px 4px rgba(37, 211, 102, 0.4);
            background-color: #1ebe5a;
        }
        .note {
            font-size: 0.8em;
            color: #888;
            margin-top: 14px;
            line-height: 1.4;
        }
        .highlight-number {
            font-weight: 600;
        }
    </style>

    <!-- TikTok Pixel Code Start -->
    <script>
        !function (w, d, t) {
          w.TiktokAnalyticsObject = t;
          var ttq = w[t] = w[t] || [];
          ttq.methods = [
            "page","track","identify","instances","debug","on","off","once","ready",
            "alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"
          ];
          ttq.setAndDefer = function (t, e) {
            t[e] = function () {
              t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
            };
          };
          for (var i = 0; i < ttq.methods.length; i++) {
            ttq.setAndDefer(ttq, ttq.methods[i]);
          }
          ttq.instance = function (t) {
            var e = ttq._i[t] || [];
            for (var n = 0; n < ttq.methods.length; n++) {
              ttq.setAndDefer(e, ttq.methods[n]);
            }
            return e;
          };
          ttq.load = function (e, n) {
            var r = "https://analytics.tiktok.com/i18n/pixel/events.js",
                o = n && n.partner;
            ttq._i = ttq._i || {};
            ttq._i[e] = [];
            ttq._i[e]._u = r;
            ttq._t = ttq._t || {};
            ttq._t[e] = +new Date;
            ttq._o = ttq._o || {};
            ttq._o[e] = n || {};
            n = d.createElement("script");
            n.type = "text/javascript";
            n.async = !0;
            n.src = r + "?sdkid=" + e + "&lib=" + t;
            e = d.getElementsByTagName("script")[0];
            e.parentNode.insertBefore(n, e);
          };

          ttq.load('D4CRMPBC77UD6NKP7IF0');
          ttq.page();
        }(window, document, 'ttq');
    </script>
    <!-- TikTok Pixel Code End -->
</head>

<body>
    <div class="container">
        <p class="title">Opening WhatsApp chat...</p>
        <div class="spinner"></div>
        <p class="tip-text">
            If WhatsApp doesn’t open automatically in a few seconds,<br>
            tap the button below to start chat.
        </p>

        <button class="wa-button" id="waButton">
            Chat on WhatsApp
        </button>

        <p class="note">
            If you see the app store or a browser page instead of chat,<br>
            please open WhatsApp and message our number:<br>
            <span class="highlight-number">+86 138-2210-2050</span>
        </p>
    </div>

    <script>
      (function() {
        // 1. WhatsApp 号码：国家码 + 手机号（不要加 + 和空格）
        var phoneNumber = "8613822102050";

        // 2. 预填消息内容
        var prefill = "Hi, I saw your TikTok about store design. My shop type is ____ and size is ____ sq ft.";
        var encodedText = encodeURIComponent(prefill);

        // 3. APP 深链接 & Web 链接
        var waAppUrl = "whatsapp://send?phone=" + phoneNumber + "&text=" + encodedText;
        var waWebUrl = "https://wa.me/" + phoneNumber + "?text=" + encodedText;

        // 4. 判断是否为移动设备
        var isMobile = /iphone|ipod|ipad|android/i.test(navigator.userAgent.toLowerCase());

        // 5. TikTok Contact 事件
        if (window.ttq && typeof window.ttq.track === "function") {
          ttq.track("Contact");
        }

        // 6. 自动跳转：统一使用 Web 链接（手机 & 电脑都先走官方网页，再由 WhatsApp 自己拉起 App）
        setTimeout(function() {
          window.location.href = waWebUrl;
        }, 3000);

        // 7. 点击按钮：移动端 = 先试 APP 深链，再兜底 Web；桌面 = 直接 Web
        var btn = document.getElementById("waButton");
        if (btn) {
          btn.addEventListener("click", function() {
            if (isMobile) {
              // 先尝试用 APP 深链
              var opened = false;

              // 尝试打开 App
              window.location.href = waAppUrl;

              // 800–1200ms 后，如果还停在当前页面（大概率 App 没被唤起），兜底跳 Web 页
              setTimeout(function() {
                if (!document.hidden) { // 页面还在前台，说明没切到 App
                  window.location.href = waWebUrl;
                }
              }, 1200);
            } else {
              // 桌面：直接用 Web
              window.location.href = waWebUrl;
            }
          });
        }
      })();
    </script>
</body>
</html>
